<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Iteration – Base R Essentials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./functions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./iteration.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Iteration</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Base R Essentials</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with Base R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Objects - Vectors, Matrices, and Arrays</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Objects - Lists and Data Frames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Subsetting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Subsetting Objects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing User-Defined Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Iteration</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#loops" id="toc-loops" class="nav-link active" data-scroll-target="#loops"><span class="header-section-number">6.1</span> Loops</a>
  <ul class="collapse">
  <li><a href="#the-for-loop" id="toc-the-for-loop" class="nav-link" data-scroll-target="#the-for-loop"><span class="header-section-number">6.1.1</span> The <code>for</code> Loop</a></li>
  <li><a href="#more-examples-of-for-loops" id="toc-more-examples-of-for-loops" class="nav-link" data-scroll-target="#more-examples-of-for-loops"><span class="header-section-number">6.1.2</span> More Examples of for Loops</a></li>
  <li><a href="#the-while-loop" id="toc-the-while-loop" class="nav-link" data-scroll-target="#the-while-loop"><span class="header-section-number">6.1.3</span> The <code>while</code> Loop</a></li>
  <li><a href="#rewriting-the-impute-function-with-a-loop" id="toc-rewriting-the-impute-function-with-a-loop" class="nav-link" data-scroll-target="#rewriting-the-impute-function-with-a-loop"><span class="header-section-number">6.1.4</span> Rewriting the <code>impute()</code> Function with a Loop</a></li>
  </ul></li>
  <li><a href="#efficient-repetition-with-apply-type-functions" id="toc-efficient-repetition-with-apply-type-functions" class="nav-link" data-scroll-target="#efficient-repetition-with-apply-type-functions"><span class="header-section-number">6.2</span> Efficient Repetition with “Apply-type” Functions</a>
  <ul class="collapse">
  <li><a href="#anonymous-functions" id="toc-anonymous-functions" class="nav-link" data-scroll-target="#anonymous-functions"><span class="header-section-number">6.2.1</span> Anonymous Functions</a></li>
  <li><a href="#apply-to-matrices" id="toc-apply-to-matrices" class="nav-link" data-scroll-target="#apply-to-matrices"><span class="header-section-number">6.2.2</span> Apply to Matrices</a></li>
  <li><a href="#applying-to-a-list-or-a-vector" id="toc-applying-to-a-list-or-a-vector" class="nav-link" data-scroll-target="#applying-to-a-list-or-a-vector"><span class="header-section-number">6.2.3</span> Applying to a List or a Vector</a></li>
  <li><a href="#applying-to-grouped-data" id="toc-applying-to-grouped-data" class="nav-link" data-scroll-target="#applying-to-grouped-data"><span class="header-section-number">6.2.4</span> Applying to Grouped Data</a></li>
  </ul></li>
  <li><a href="#when-to-use-loops-apply-type-functions-or-vectorized-calculations" id="toc-when-to-use-loops-apply-type-functions-or-vectorized-calculations" class="nav-link" data-scroll-target="#when-to-use-loops-apply-type-functions-or-vectorized-calculations"><span class="header-section-number">6.3</span> When to Use Loops, Apply-Type Functions, or Vectorized Calculations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Iteration</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Iteration is a key programming technique that allows you to automate repetitive tasks and perform operations systematically across elements of a vector, list, or data frame. In R, loops and apply-like functions provide powerful tools for processing data, especially when the same operation must be carried out multiple times across different values or structures.</p>
<p>This capability is particularly useful in data analysis workflows, where repeated calculations, conditional checks, or transformations are common. By using iteration, you can reduce code duplication, enhance clarity, and minimize the risk of manual errors. Moreover, iterative structures make your scripts more dynamic and adaptable, supporting cleaner logic and easier maintenance.</p>
<p>In this chapter, we will first explore traditional loop constructs, such as <code>for</code> and <code>while</code>, which offer explicit control over iteration. We will then introduce the family of apply-like functions, which provide an alternative, more concise way to perform repetitive operations on elements of a data structure. While apply-like functions are not always faster than loops, they often improve code readability and help avoid manual indexing, making your scripts cleaner and easier to maintain.</p>
<section id="loops" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="loops"><span class="header-section-number">6.1</span> Loops</h2>
<p>TLoops allow you to perform the same operation multiple times, making them useful for automating repetitive tasks in R. While many tasks in R can be handled using vectorized functions, there are situations where loops offer more control and flexibility—especially when working with conditions, custom logic, or sequences of unknown length. In this section, we will focus on three types of loops in Base R: <code>for</code>, <code>while</code>, and <code>repeat</code>. Among them, the <code>for</code> loop is the most commonly used and is a good starting point for beginners. We will also revisit a practical example from the previous chapter to demonstrate how loops can make your code more efficient and adaptable.</p>
<section id="the-for-loop" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="the-for-loop"><span class="header-section-number">6.1.1</span> The <code>for</code> Loop</h3>
<p>A <code>for</code> loop allows you to repeat a task a specific number of times. This type of loop is most useful when the number of iterations is known ahead of time. Let’s use an example to walk through how a <code>for</code> loop is constructed.</p>
<p>Suppose we have blood pressure and pulse measurements from several patients stored in a matrix called <code>bp</code>. Each column represents a different type of measurement—systolic pressure, diastolic pressure, and pulse rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">systolic  =</span> <span class="fu">c</span>(<span class="dv">120</span>, <span class="dv">122</span>, <span class="cn">NA</span>, <span class="dv">118</span>, <span class="dv">130</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">diastolic =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">78</span>, <span class="dv">85</span>, <span class="dv">82</span>, <span class="dv">79</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pulse     =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">72</span>, <span class="dv">68</span>, <span class="dv">75</span>, <span class="dv">71</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to calculate the mean value for each column, we could manually repeat the following commands:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bp[, <span class="dv">1</span>], <span class="at">na.rm=</span>T)  <span class="co"># systolic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 122.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bp[, <span class="dv">2</span>], <span class="at">na.rm=</span>T)  <span class="co"># diastolic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bp[, <span class="dv">3</span>], <span class="at">na.rm=</span>T)  <span class="co"># pulse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 71.2</code></pre>
</div>
</div>
<p>Each command is nearly identical except for the column index. In this situation, we can use a <code>for</code> loop to eliminate repetition and make the code more flexible.</p>
<p><strong>Three Components of a <code>for</code> Loop</strong></p>
<p>Let’s break the loop construction into three steps:</p>
<p><strong>1. Prepare a place to store the result</strong></p>
<p>Since we will compute one median per column, we need a numeric vector of the same length as the number of columns in <code>bp</code>. The <code>numeric()</code> function creates a numeric vector of the specified length.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">ncol</span>(bp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2. Create a loop with an index variable</strong></p>
<p>To repeat an operation three times—once for each column—we use a <code>for</code> loop. The index variable <code>i</code> will take on the values 1, 2, and 3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, a more flexible version uses <code>ncol(bp)</code> so that the loop works even if the number of columns changes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(bp)) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>3. Write the loop body</strong></p>
<p>Inside the loop, we want to compute the mean of the <span class="math inline">\(i^{th}\)</span> column and store it in the <span class="math inline">\(i^{th}\)</span> position of the <code>output</code> vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(bp)) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  output[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(bp[, i], <span class="at">na.rm=</span>T)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Final Code</strong></p>
<p>Putting it all together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">ncol</span>(bp))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(bp)) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  output[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(bp[, i], <span class="at">na.rm=</span>T)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 122.5  80.8  71.2</code></pre>
</div>
</div>
<p>This loop is functionally equivalent to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(bp[, <span class="dv">1</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(bp[, <span class="dv">2</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(bp[, <span class="dv">3</span>], <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using a loop avoids repetitive code and ensures your script remains flexible if the number of columns changes later.</p>
<p>✻ <strong>Note</strong>: The structure of this example—first pre-allocating output, then defining the iteration sequence, and finally writing the loop body—is inspired by the clear and practical approach described in <em>R for Data Science</em> <span class="citation" data-cites="wickham2023r">(<a href="#ref-wickham2023r" role="doc-biblioref">Wickham, Çetinkaya-Rundel, and Grolemund 2023</a>)</span>.</p>
</section>
<section id="more-examples-of-for-loops" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="more-examples-of-for-loops"><span class="header-section-number">6.1.2</span> More Examples of for Loops</h3>
<p>While the previous section focused on looping through columns of a matrix, we can also use for loops to process vectors, perform sequential comparisons, and work with lists. The following examples demonstrate how loops can be applied in various situations.</p>
<p>If you are unsure how to begin writing a loop, a good strategy is to first write out a few lines of code manually—without a loop—then identify the parts that repeat. This helps you recognize the pattern, making it easier to convert those lines into a loop structure. Each example below walks through this approach to reinforce the logic behind loop construction.</p>
<p>In the following example, we consider a list of sales figures from different stores. We want to calculate and report the average sales for each store. Let’s begin by creating the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sales_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_A =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">220</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_B =</span> <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">320</span>, <span class="dv">310</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_C =</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">180</span>, <span class="dv">170</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To calculate the average for each store without using a loop, we could write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average sales for store_A:"</span>, <span class="fu">mean</span>(sales_data[[<span class="st">"store_A"</span>]]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average sales for store_A: 223.3333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average sales for store_B:"</span>, <span class="fu">mean</span>(sales_data[[<span class="st">"store_B"</span>]]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average sales for store_B: 310 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average sales for store_C:"</span>, <span class="fu">mean</span>(sales_data[[<span class="st">"store_C"</span>]]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average sales for store_C: 166.6667 </code></pre>
</div>
</div>
<p>Each command follows the same structure: retrieve the sales vector by name, calculate the mean, and print the result. This kind of repetition is a good opportunity to switch to a loop.</p>
<p>Now let’s write a <code>for</code> loop to handle the task more efficiently:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(sales_data)) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Average sales for"</span>, name, <span class="st">":"</span>, <span class="fu">mean</span>(sales_data[[name]]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average sales for store_A : 223.3333 
Average sales for store_B : 310 
Average sales for store_C : 166.6667 </code></pre>
</div>
</div>
<p>The loop iterates over the names of the list elements. We are using the names of the list as the indexing sequence; at each iteration, the variable <code>name</code> is automatically assigned one of the list’s names (such as <code>"store_A"</code>, <code>"store_B"</code>, or <code>"store_C"</code>). It then retrieves the values associated with the current name using double square brackets (<code>[[ ]]</code>), computes the mean, and prints a message using <code>cat()</code>. This loop accomplishes the same result as before, but in a more compact and generalizable way.</p>
<p>In the following example, we are classifying a set of body temperature readings. If a temperature is 100.4°F or higher, we consider it “Fever”; otherwise, it is “Normal.”</p>
<p>Before jumping into a loop, one useful approach is to write out the steps manually for a few values. This helps clarify the pattern and logic:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>body_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">98.6</span>, <span class="fl">101.2</span>, <span class="fl">100.8</span>, <span class="fl">98.7</span>, <span class="fl">99.1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="fu">length</span>(body_temp))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (body_temp[<span class="dv">1</span>] <span class="sc">&gt;=</span> <span class="fl">100.4</span>) {</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Fever</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Fever"</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Normal</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Normal"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>98.6 : Normal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (body_temp[<span class="dv">2</span>] <span class="sc">&gt;=</span> <span class="fl">100.4</span>) {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Fever</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Fever"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Normal</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Normal"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>98.6 : Fever</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (body_temp[<span class="dv">3</span>] <span class="sc">&gt;=</span> <span class="fl">100.4</span>) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Fever</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Fever"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(body_temp[<span class="dv">1</span>], <span class="st">": Normal</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  status[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Normal"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>98.6 : Fever</code></pre>
</div>
</div>
<p>This approach becomes tedious and error-prone as the vector grows. Notice that only the index changes across each block. Once we recognize this repeating structure, we can rewrite the task using a <code>for</code> loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>body_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">98.6</span>, <span class="fl">101.2</span>, <span class="fl">100.8</span>, <span class="fl">98.7</span>, <span class="fl">99.1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="fu">length</span>(body_temp))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(body_temp)) {</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (body_temp[i] <span class="sc">&gt;=</span> <span class="fl">100.4</span>) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(body_temp[i], <span class="st">": Fever</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    status[i] <span class="ot">&lt;-</span> <span class="st">"Fever"</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(body_temp[i], <span class="st">": Normal</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    status[i] <span class="ot">&lt;-</span> <span class="st">"Normal"</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>98.6 : Normal
101.2 : Fever
100.8 : Fever
98.7 : Normal
99.1 : Normal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Normal" "Fever"  "Fever"  "Normal" "Normal"</code></pre>
</div>
</div>
<p>We use <code>seq_along(body_temp)</code> rather than <code>1:length(body_temp)</code> because it’s safer. If the input vector were ever empty, <code>seq_along()</code> would return an empty sequence, while <code>1:length(x)</code> would return <code>1:0</code>, which evaluates to <code>c(1, 0)</code>—an unexpected result that could cause bugs in your code.</p>
<p>In the next example, we will use the <code>status</code> vector we just created to detect how often a patient’s condition fluctuates over a series of temperature readings. Specifically, we want to count how many times the status changes from one reading to the next.</p>
<p>A good way to approach this kind of problem is to begin by writing out a few comparisons manually, without using a loop. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fluctuations <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (status[<span class="dv">2</span>] <span class="sc">!=</span> status[<span class="dv">1</span>]) {</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  fluctuations <span class="ot">&lt;-</span> fluctuations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (status[<span class="dv">3</span>] <span class="sc">!=</span> status[<span class="dv">2</span>]) {</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  fluctuations <span class="ot">&lt;-</span> fluctuations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (status[<span class="dv">4</span>] <span class="sc">!=</span> status[<span class="dv">3</span>]) {</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  fluctuations <span class="ot">&lt;-</span> fluctuations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (status[<span class="dv">5</span>] <span class="sc">!=</span> status[<span class="dv">4</span>]) {</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  fluctuations <span class="ot">&lt;-</span> fluctuations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>fluctuations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>By writing out these steps, we make the logic of the task explicit: each comparison checks whether the current status differs from the previous one, and if so, increments a counter. This repetition makes it a good candidate for a loop.</p>
<p>We can now rewrite the same logic using a <code>for</code> loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fluctuations <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(status)) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (status[i] <span class="sc">!=</span> status[i <span class="sc">-</span> <span class="dv">1</span>]) {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    fluctuations <span class="ot">&lt;-</span> fluctuations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>fluctuations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>This loop performs the same sequence of comparisons but in a more compact and scalable way. It also illustrates one of the strengths of loop structures: applying a repeated operation over a sequence of elements, especially when the current step depends on the previous one.</p>
</section>
<section id="the-while-loop" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="the-while-loop"><span class="header-section-number">6.1.3</span> The <code>while</code> Loop</h3>
<p>In many situations, we know ahead of time how many times a loop should run, which makes <code>for</code> loops a natural choice. However, there are cases where the number of iterations is not known in advance. In those cases, we can use a <code>while</code> loop.</p>
<p>A <code>while</code> loop contains a condition and a body. The loop continues to run as long as the condition evaluates to TRUE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (condition) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## code to execute</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The key idea behind a <code>while</code> loop is that the stopping point depends on a condition that is evaluated <em>within</em> the loop. Let’s look at a practical example.</p>
<p>Suppose we receive patient records in random order, and we want to search through them until we find the one with ID 1005.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>patient_ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1001</span><span class="sc">:</span><span class="dv">1010</span>)  <span class="co"># randomly shuffled IDs</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (patient_ids[i] <span class="sc">!=</span> <span class="dv">1005</span>) {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Checked patient"</span>, patient_ids[i], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Checked patient 1003 
Checked patient 1010 
Checked patient 1002 
Checked patient 1008 
Checked patient 1006 
Checked patient 1009 
Checked patient 1001 
Checked patient 1007 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Found patient"</span>, patient_ids[i], <span class="st">"- stopping.</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found patient 1005 - stopping.</code></pre>
</div>
</div>
<p>In this case, we do not know how many patients we’ll need to examine. The loop runs until we encounter the target ID. Note that the index variable <code>i</code> must be initialized before the loop and updated manually inside the loop body. Without this, the loop may never terminate.</p>
<p>Although any <code>for</code> loop can be rewritten as a <code>while</code> loop, the reverse is not true—some problems require <code>while</code> because the exit condition depends on dynamic logic, not a predefined sequence.</p>
<p>We can also mention two additional loop tools:</p>
<ul>
<li>The <code>repeat</code> loop, which runs indefinitely until a <code>break</code> statement is encountered.</li>
<li>The <code>break</code> command, which can be used inside any loop to exit early when a condition is met.</li>
</ul>
<p>These constructs are not commonly needed for most routine data tasks, so we will not explore them further here.</p>
</section>
<section id="rewriting-the-impute-function-with-a-loop" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="rewriting-the-impute-function-with-a-loop"><span class="header-section-number">6.1.4</span> Rewriting the <code>impute()</code> Function with a Loop</h3>
<p>In the previous chapter, we introduced the <code>impute()</code> function, which handled missing values for a single variable at a time. However, when multiple variables require imputation, repeating the same function call is inefficient. A loop allows us to process all specified variables in one pass, making the function more flexible and scalable.</p>
<p>To rewrite the function, we follow three basic steps. First, we identify the sequence of variables to loop over. In this case, we use a character vector <code>var_list</code> containing the names of the variables to be imputed. Second, we create the loop. This can be done with a standard index like <code>1:length(var_list)</code>, though it is generally safer to use <code>seq_along(var_list)</code> to avoid issues when the list is empty. Finally, we write the loop body, which applies the imputation logic to each variable.</p>
<p>At the beginning of the loop, we extract the name of the current variable using <code>var_name &lt;- var_list[i]</code>, and then proceed with the imputation logic used previously. After filling in the missing values, we update the column in the original dataset.</p>
<p>Here is the final version of the function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>impute_N <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, var_list){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(var_list)){</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    var_name <span class="ot">&lt;-</span> var_list[i]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    select_var <span class="ot">&lt;-</span> dat[[var_name]]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.numeric</span>(select_var)) {</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>      replace_value <span class="ot">&lt;-</span> <span class="fu">median</span>(select_var, <span class="at">na.rm=</span>T)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      tab_result <span class="ot">&lt;-</span> <span class="fu">table</span>(select_var)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      high_freq <span class="ot">&lt;-</span> <span class="fu">max</span>(tab_result)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      replace_value <span class="ot">&lt;-</span><span class="fu">names</span>(tab_result)[tab_result <span class="sc">==</span> high_freq]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    select_var[<span class="fu">is.na</span>(select_var)] <span class="ot">&lt;-</span> replace_value</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    dat[[var_name]] <span class="ot">&lt;-</span> select_var</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To apply the function, we pass both the dataset and a character vector of variable names to be imputed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">impute_N</span>(patient, <span class="fu">c</span>(<span class="st">"TGL"</span>, <span class="st">"HDL"</span>, <span class="st">"LDL"</span>, <span class="st">"HRT"</span>, <span class="st">"MAMM"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID GLUC TGL  HDL LDL HRT MAMM SMOKE
1   A   88 180 32.0  99   Y    Y     Y
2   B   NA 150 60.0 165   Y    Y  &lt;NA&gt;
3   C  110 180 62.5 120   N    N     N
4   D   NA 200 65.0 165   Y    Y  &lt;NA&gt;
5   E   90 210 62.5 150   Y    Y     Y
6   F   88 180 32.0 210   Y    Y  &lt;NA&gt;
7   G  120 164 62.5 165   Y    Y     Y
8   H  110 170 70.0 188   Y    Y  &lt;NA&gt;
9   I   NA 190 62.5 190   N    N     N
10  J   90 180 75.0 165   Y    Y  &lt;NA&gt;</code></pre>
</div>
</div>
<p>This version of the <code>impute()</code> function can handle any number of variables and illustrates how a for loop can help automate repetitive tasks in a structured and reliable way.</p>
</section>
</section>
<section id="efficient-repetition-with-apply-type-functions" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="efficient-repetition-with-apply-type-functions"><span class="header-section-number">6.2</span> Efficient Repetition with “Apply-type” Functions</h2>
<p>Many data analysis tasks involve performing the same computation repeatedly across different parts of a data structure—such as rows of a matrix, columns of a data frame, or elements of a list. While loops can be used for such repetition, R provides a set of vectorized tools called <em>apply-type</em> functions that often make code shorter, faster, and more expressive. The table below summarizes the most commonly used apply-type functions and highlights their typical inputs and outputs:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 20%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Input Type</th>
<th>Applies Function To</th>
<th>Output Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>apply()</code></td>
<td>Matrix or data frame</td>
<td>Rows (1), Columns (2), or both</td>
<td>Vector, matrix, or list</td>
<td>Often used for row/column operations</td>
</tr>
<tr class="even">
<td><code>lapply()</code></td>
<td>Vector, list or data frame</td>
<td>Each element</td>
<td>List</td>
<td>Always returns a list</td>
</tr>
<tr class="odd">
<td><code>sapply()</code></td>
<td>Vector, list or data frame</td>
<td>Each element</td>
<td>Simplified result</td>
<td>Tries to simplify (e.g., to vector or matrix)</td>
</tr>
<tr class="even">
<td><code>vapply()</code></td>
<td>Vector or List</td>
<td>Each element</td>
<td>Pre-specified format</td>
<td>Safer, but more verbose than <code>sapply()</code></td>
</tr>
<tr class="odd">
<td><code>tapply()</code></td>
<td>Vector</td>
<td>Groups defined by factor(s)</td>
<td>Array or vector</td>
<td>Used for grouped summary statistics</td>
</tr>
<tr class="even">
<td><code>mapply()</code></td>
<td>Multiple vectors</td>
<td>Elements in parallel</td>
<td>List or simplified</td>
<td>Multivariate version of <code>sapply()</code></td>
</tr>
<tr class="odd">
<td><code>Map()</code></td>
<td>Multiple vectors</td>
<td>Elements in parallel</td>
<td>List</td>
<td>Similar to <code>mapply()</code>, but returns a list always</td>
</tr>
<tr class="even">
<td><code>replicate()</code></td>
<td>Expression</td>
<td>Repeated evaluation</td>
<td>Vector, matrix, or list</td>
<td>Useful for simulation or bootstrapping</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: The functions mapply(), Map(), and replicate() are not covered in this chapter. You are encouraged to explore their usage by reading the official R documentation if you’re interested.</p>
<section id="anonymous-functions" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="anonymous-functions"><span class="header-section-number">6.2.1</span> Anonymous Functions</h3>
<p>Before we learn how to use apply-type functions, let’s take a moment to understand anonymous functions, which are often used together with these tools.</p>
<p>An anonymous function is simply a function that does not have a name. Instead of assigning it to an object, we define and use it on the fly—typically for one-time or short-term use. This can be helpful when the function is simple and doesn’t need to be reused elsewhere.</p>
<p>Here is the traditional syntax for writing a simple function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>double <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">double</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>Note that we did not use curly braces since the function body contains only a single command. Now, we can define the same logic anonymously, without assigning the function to a name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(<span class="cf">function</span>(x) <span class="dv">2</span> <span class="sc">*</span> x)(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>This creates the function and immediately applies it to the value 10. The function works the same way because the named function <code>double</code> on the left-hand side of the assignment operator (<code>&lt;-</code>) is equivalent to everything on the right: <code>function(x) 2 * x</code>.</p>
<p>Starting with R version 4.1.0, a new and more compact syntax was introduced: we can replace the keyword <code>function</code> with a backslash (<code>\</code>). For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>double <span class="ot">&lt;-</span> \(x) <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">double</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>This shorthand notation is especially useful when writing anonymous functions inline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(\(x) <span class="dv">2</span> <span class="sc">*</span> x) (<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>Anonymous functions can also contain multiple statements by wrapping the body in curly braces. For example, here’s a function that prints a number, doubles it, and then returns the result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(\(x) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Input value is:"</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>})(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Input value is: 7 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
<p>Although short, one-line anonymous functions are more common, it’s good to know that multi-step logic can be included when needed.</p>
</section>
<section id="apply-to-matrices" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="apply-to-matrices"><span class="header-section-number">6.2.2</span> Apply to Matrices</h3>
<p>R provides several built-in functions for computing summary statistics across the rows or columns of a matrix, including <code>rowSums()</code>, <code>rowMeans()</code>, <code>colSums()</code>, and <code>colMeans()</code>. However, for more flexible and general-purpose operations, the <code>apply()</code> function is a powerful tool.</p>
<p>The <code>apply()</code> function takes the following arguments:</p>
<ul>
<li><code>X</code>: a matrix or an array.</li>
<li><code>MARGIN</code>: an integer indicating the dimension(s) to apply the function over. Use 1 for rows, 2 for columns</li>
<li><code>FUN</code>: a function (either built-in or user-defined) to apply to each row or column.</li>
<li><code>...</code>: additional arguments to be passed to the function specified in FUN.</li>
</ul>
<p>The result returned by <code>apply()</code> is typically a vector or matrix, depending on the output of the function and the margin specified.</p>
<p>Let’s revisit our blood pressure matrix example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bp </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     systolic diastolic pulse
[1,]      120        80    70
[2,]      122        78    72
[3,]       NA        85    68
[4,]      118        82    75
[5,]      130        79    71</code></pre>
</div>
</div>
<p>When we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(bp, <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> systolic diastolic     pulse 
       NA      80.8      71.2 </code></pre>
</div>
</div>
<p>we are instructing R to compute the median for each column of the matrix. Internally, the <code>apply()</code> function loops through the matrix column by column, passing each column (as a vector) into the <code>mean()</code> function. Similarly, if we want to compute the mean for each row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(bp, <span class="dv">1</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 90.00000 90.66667       NA 91.66667 93.33333</code></pre>
</div>
</div>
<p>this time, each row is treated as the input to <code>mean()</code>. In both cases, <code>apply()</code> eliminates the need to write out a manual loop.</p>
<p>By default, <code>mean()</code> will return <code>NA</code> if any value is missing. To handle this, we need to specify the optional argument <code>na.rm = TRUE</code>. This additional argument is written in the form of <code>parameter = value</code> and placed after the function name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(bp, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> systolic diastolic     pulse 
    122.5      80.8      71.2 </code></pre>
</div>
</div>
<p>The optional arguments <code>na.rm = TRUE</code> are passed along directly to <code>mean()</code>. You can include as many optional arguments as needed. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(bp, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> systolic diastolic     pulse 
    122.5      80.8      71.2 </code></pre>
</div>
</div>
</section>
<section id="applying-to-a-list-or-a-vector" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="applying-to-a-list-or-a-vector"><span class="header-section-number">6.2.3</span> Applying to a List or a Vector</h3>
<p>Most R functions are designed to work element-by-element on vectors. However, these same functions do not always work directly on lists. To address this, R provides a family of apply-type functions specifically designed for iterating over the elements of a list or vector. The most commonly used ones are <code>lapply()</code>, <code>sapply()</code>, and <code>vapply()</code>.</p>
<p>These functions share a similar interface:</p>
<ul>
<li><code>X</code>: a vector or a list.</li>
<li><code>FUN</code>: a function to be applied to each element.</li>
<li><code>...</code>: optional arguments passed to FUN.</li>
</ul>
<p><code>lapply()</code> vs <code>sapply()</code></p>
<p>The difference lies in what they return:</p>
<ul>
<li><code>lapply()</code> always returns a list, regardless of the output of the applied function.</li>
<li><code>sapply()</code> tries to simplify the result to a vector, or matrix if possible. If not, it falls back to a list.</li>
</ul>
<p>Let’s walk through an example. Suppose we have a list where each element is a numeric vector. We want to calculate the mean of each component:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] 3.762096

$b
[1] 4.732654

$c
[1] 2.090286</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       a        b        c 
3.762096 4.732654 2.090286 </code></pre>
</div>
</div>
<p>Notice that the <code>sapply()</code> function above simplifies the result into a vector, whereas the <code>lapply()</code> function returns a list as the result.</p>
<p><strong>Using Custom or Anonymous Functions</strong></p>
<p>You are not limited to built-in functions. You can also apply your own:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mean_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T), <span class="at">SD =</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(a, mean_sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
    MEAN       SD 
3.762096 3.653015 

$b
    MEAN       SD 
4.732654 1.911215 

$c
    MEAN       SD 
2.090286 0.720553 </code></pre>
</div>
</div>
<p>Or define the function inline using an anonymous function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(a, <span class="cf">function</span>(x) {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">SD =</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            a        b        c
MEAN 3.762096 4.732654 2.090286
SD   3.653015 1.911215 0.720553</code></pre>
</div>
</div>
<p>Or use the new function notation by typing the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(a, \(x) {</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">SD =</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            a        b        c
MEAN 3.762096 4.732654 2.090286
SD   3.653015 1.911215 0.720553</code></pre>
</div>
</div>
<p><strong>A Safer Alternative: <code>vapply()</code></strong></p>
<p>While <code>sapply()</code> is convenient, it can be unpredictable in what it returns. This is where <code>vapply()</code> comes in—it requires you to specify the exact structure of the output, making the result more stable and safer to use in programming.</p>
<p>For example, if we know that the result should always be a single numeric value, we can use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(a, mean, <span class="fu">numeric</span>(<span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       a        b        c 
3.762096 4.732654 2.090286 </code></pre>
</div>
</div>
<p>If each function call returns a vector of two named values, we can specify:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(a, \(x) <span class="fu">c</span>(<span class="at">MEAN =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SD =</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">numeric</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            a        b        c
MEAN 3.762096 4.732654 2.090286
SD   3.653015 1.911215 0.720553</code></pre>
</div>
</div>
<p>Specifying the expected result type with <code>numeric(2)</code> ensures consistent output and helps catch errors early.</p>
<p><strong>Lists vs Data Frames</strong></p>
<p>Remember that data frames are actually lists of equal-length vectors. This means we can apply these same functions to each column of a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">var1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">var2 =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(d, <span class="dv">2</span>, sum)            <span class="co"># Treats data frame as matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1 var2 
  11   18 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(d, sum)              <span class="co"># Treats columns as list elements</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1 var2 
  11   18 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(d, sum)              <span class="co"># Same, but returns a list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$var1
[1] 11

$var2
[1] 18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(d, sum, <span class="fu">numeric</span>(<span class="dv">1</span>))  <span class="co"># Safe version, ensures numeric output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1 var2 
  11   18 </code></pre>
</div>
</div>
<p>In general:</p>
<ul>
<li>Use <code>lapply()</code> when you want list output.</li>
<li>Use <code>sapply()</code> when you want a simplified output (but are okay with some risk).</li>
<li>Use <code>vapply()</code> when you want strict control over the return type.</li>
</ul>
</section>
<section id="applying-to-grouped-data" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="applying-to-grouped-data"><span class="header-section-number">6.2.4</span> Applying to Grouped Data</h3>
<p>The <code>tapply()</code> function is designed to apply a function to subsets of a vector, where the subsets are defined by the levels of one or more categorical variables (factors). This is especially useful when you want to compute summary statistics within groups.</p>
<p>Here are the key arguments of the <code>tapply()</code> function:</p>
<ul>
<li><code>X</code>: A numeric (or character) vector containing the values to be operated on.</li>
<li><code>INDEX</code>: A factor or list of factors that defines the grouping. Each unique combination of factor levels determines one subset of <code>X</code>.</li>
<li><code>FUN</code>: The function to apply to each group.</li>
<li><code>...</code>: Additional arguments passed to FUN.</li>
</ul>
<p>We will use the quine data frame from the MASS package to illustrate how <code>tapply()</code> works. This dataset includes information about school absences among children in Walgett, New South Wales, Australia. The <code>Days</code> column records the number of days a student was absent during the school year, and other columns classify students by Ethnicity (<code>Eth</code>), <code>Age</code>, <code>Sex</code>, and Learner status (<code>Lrn</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(quine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Eth Sex Age Lrn Days
1   A   M  F0  SL    2
2   A   M  F0  SL   11
3   A   M  F0  SL   14
4   A   M  F0  AL    5
5   A   M  F0  AL    5
6   A   M  F0  AL   13</code></pre>
</div>
</div>
<p><strong>Applying <code>tapply()</code> with a Single Grouping Variable</strong></p>
<p>Suppose we want to calculate the mean number of days absent for each age group. We can do this by grouping <code>quine$Days</code> by <code>quine$Age</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(quine<span class="sc">$</span>Days, quine<span class="sc">$</span>Age, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      F0       F1       F2       F3 
14.85185 11.15217 21.05000 19.60606 </code></pre>
</div>
</div>
<p>This returns the average number of days absent for each level of the <code>Age</code> factor.</p>
<p><strong>Applying <code>tapply()</code> with Multiple Grouping Variables</strong></p>
<p>We can also apply a function across multiple grouping variables by passing a list of factors to the <code>INDEX</code> argument. For example, to compute the mean number of days absent by both <code>Age</code> and <code>Sex</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(quine<span class="sc">$</span>Days, <span class="fu">list</span>(quine<span class="sc">$</span>Age, quine<span class="sc">$</span>Sex), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          F        M
F0 18.70000 12.58824
F1 12.96875  7.00000
F2 18.42105 23.42857
F3 14.00000 27.21429</code></pre>
</div>
</div>
<p>This produces a table where each cell shows the average number of days absent for a specific combination of <code>Age</code> and <code>Sex</code>.</p>
<p>When using multiple grouping variables, <code>tapply()</code> outputs a matrix-like structure (if possible) that makes cross-group comparisons easier.</p>
<p><strong>Splitting the Data</strong></p>
<p>Sometimes, it’s more convenient to split the data into a list and then apply operations to each component using <code>lapply()</code> or <code>sapply()</code>. The <code>split()</code> function divides a data vector or a data frame based on one or more grouping factors. Its two primary arguments are:</p>
<ul>
<li><code>x</code>: a vector or a data frame to be split.</li>
<li><code>f</code>: a factor (or list of factors) used to define the groups.</li>
</ul>
<p>The result is a list, where each element corresponds to one level (or combination of levels) of the grouping factor(s).</p>
<p>While the <code>tapply()</code> function offers a compact way to apply a function across groups, the <code>split()</code> + <code>sapply()</code> (or <code>lapply()</code>) approach offers greater flexibility, especially when you want to perform multiple operations on each group.</p>
<p>For example, to compute the mean number of days absent for each <code>Age</code> group in the quine dataset, we can first split the Days variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Days_by_Age <span class="ot">&lt;-</span> <span class="fu">split</span>(quine<span class="sc">$</span>Days, quine<span class="sc">$</span>Age)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>Days_by_Age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$F0
 [1]  2 11 14  5  5 13 20 22  3  5 11 24 45  6 17 67  0  0  2  7 11 12 25 10 11
[26] 20 33

$F1
 [1]  6  6 15  7 14  5  6  6  9 13 23 25 32 53 54  5  5 11 17 19  0  0  5  5  5
[26] 11 17  3  4  5  7  0  1  5  5  5  5  7 11 15  5 14  6  6  7 28

$F2
 [1]  6 32 53 57 14 16 16 17 40 43 46  8 13 14 20 47 48 60 81  2 22 30 36  8  0
[26]  1  5  7 16 27  0  5 14  2  2  3  8 10 12  1

$F3
 [1]  8 23 23 28 34 36 38  0  2  3  5 10 14 21 36 40  0 30 10 14 27 41 69  1  9
[26] 22  3  3  5 15 18 22 37</code></pre>
</div>
</div>
<p>Now that we have a list, we can easily apply a function to each element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(Days_by_Age, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      F0       F1       F2       F3 
14.85185 11.15217 21.05000 19.60606 </code></pre>
</div>
</div>
<p>This produces the same result as <code>tapply()</code>, but in a format that may be easier to extend or customize.</p>
<p>We can also perform multiple calculations per group. For example, to compute both the mean and the median:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">split</span>(quine<span class="sc">$</span>Days, quine<span class="sc">$</span>Age), </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>       \(x){</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">Median =</span> <span class="fu">median</span>(x))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             F0       F1    F2       F3
Mean   14.85185 11.15217 21.05 19.60606
Median 11.00000  6.00000 14.00 18.00000</code></pre>
</div>
</div>
<p>To group by more than one factor—say, both <code>Age</code> and <code>Sex</code>—we can pass a list of factors to <code>split()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">split</span>(quine<span class="sc">$</span>Days, <span class="fu">list</span>(quine<span class="sc">$</span>Age, quine<span class="sc">$</span>Sex)),</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>       \(x) {</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">Median =</span> <span class="fu">median</span>(x))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       F0.F     F1.F     F2.F F3.F     F0.M F1.M     F2.M     F3.M
Mean   18.7 12.96875 18.42105   14 12.58824  7.0 23.42857 27.21429
Median 15.5  7.00000 10.00000   10 11.00000  5.5 17.00000 27.50000</code></pre>
</div>
</div>
<p>This approach is especially powerful when used with anonymous functions. It allows us to write concise, flexible code that can be adapted to a wide range of grouped operations.</p>
<p><strong>Why Prefer split() with sapply()?</strong></p>
<p>Although <code>tapply()</code> is convenient for computing a single summary statistic per group, it becomes less manageable when:</p>
<ul>
<li>more than one grouping factor is used, and</li>
<li>the applied function returns multiple values (e.g., mean and median).</li>
</ul>
<p>Consider the following example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(quine<span class="sc">$</span>Days, <span class="fu">list</span>(quine<span class="sc">$</span>Age, quine<span class="sc">$</span>Sex), \(x) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(x), <span class="at">Median =</span> <span class="fu">median</span>(x))</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   F         M        
F0 numeric,2 numeric,2
F1 numeric,2 numeric,2
F2 numeric,2 numeric,2
F3 numeric,2 numeric,2</code></pre>
</div>
</div>
<p>This returns a matrix-like object where each cell contains a vector of length two.</p>
<p>While technically correct, this result can be cumbersome to work with, especially if you’re trying to extract or manipulate specific summary values later on.</p>
<p>In contrast, the combination of <code>split()</code> and <code>sapply()</code> provides more predictable and structured output, typically in the form of a named matrix or list. This makes it easier to interpret and use in subsequent steps of your analysis.</p>
</section>
</section>
<section id="when-to-use-loops-apply-type-functions-or-vectorized-calculations" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="when-to-use-loops-apply-type-functions-or-vectorized-calculations"><span class="header-section-number">6.3</span> When to Use Loops, Apply-Type Functions, or Vectorized Calculations</h2>
<p>In R, you’ll often find that a task can be solved in several different ways. The three most common approaches are:</p>
<ul>
<li>Using loops (<code>for</code>, <code>while</code>, or <code>repeat</code>)</li>
<li>Using apply-type functions (like <code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, <code>tapply()</code>, <code>vapply()</code>)</li>
<li>Using vectorized operations (like <code>mean()</code>, <code>sum()</code>, <code>ifelse()</code>, <code>colMeans()</code>, and arithmetic on entire vectors)</li>
</ul>
<p>Understanding the strengths and use cases of each will help you write clearer and more efficient R code.</p>
<p><strong>When to Use Loops</strong></p>
<p>Loops give you full control over each step of a process. They’re ideal when:</p>
<ul>
<li>Each step depends on the result of the previous one. Example: tracking a running total or detecting state transitions in a time series</li>
<li>You need to perform a custom sequence of actions. Example: printing different messages, updating external variables</li>
<li>The logic is complex or has conditional branching. Example: applying different formulas based on user input or specific criteria</li>
<li>You are prototyping or still learning the logic. Loops are easy to read and good for step-by-step debugging</li>
</ul>
<p>However, a common downside of loops is that the result is often embedded inside the loop, such as being updated step by step. This can make it harder for others (or even yourself later) to figure out what the loop is producing unless they read through the whole body.</p>
<p><strong>When to Use Apply-Type Functions</strong></p>
<p>Apply-type functions offer a middle ground between loops and vectorized code. They let you repeat an operation over elements of a list, matrix, or grouped data, often in fewer lines than a loop.</p>
<ul>
<li>Use <code>apply()</code> for rows or columns of a matrix</li>
<li>Use <code>lapply()</code> or <code>sapply()</code> for elements in a list or columns in a data frame</li>
<li>Use <code>vapply()</code> when you want to enforce the type and length of the result</li>
<li>Use <code>tapply()</code> or <code>split()</code> + <code>sapply()</code> to summarize values by groups</li>
</ul>
<p>These functions are especially useful when:</p>
<ul>
<li>The task is repetitive and follows a predictable pattern</li>
<li>You want cleaner code without writing an explicit loop</li>
<li>You’re applying the same function to multiple elements or groups</li>
</ul>
<p>Apply-type functions also work well with anonymous functions, such as <code>\(x) x^2</code>, making them ideal for short, one-time logic.</p>
<p><strong>When to Use Vectorized Calculations</strong></p>
<p>Vectorized operations are fast, expressive, and concise. Whenever your logic can be expressed as an operation on entire vectors, this is the preferred route.</p>
<p>Use vectorized functions when:</p>
<ul>
<li>You’re applying the same simple transformation to every element</li>
<li>You are classifying, summarizing, or transforming numeric or logical vectors</li>
<li>Built-in functions already exist for the task (e.g., <code>mean()</code>, <code>sum()</code>, <code>ifelse()</code>)</li>
</ul>
<p>Vectorized code is usually more efficient because it’s executed in compiled C code under the hood. Examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(values)  <span class="co"># Vectorized log transformation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000000 2.302585 4.605170 6.907755</code></pre>
</div>
</div>
<p>In general, start with loops when you’re developing or learning, then refactor using apply-type or vectorized solutions for clarity and performance. Prefer apply-type functions when you want a readable result that’s clearly assigned, rather than hidden inside the loop body.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-wickham2023r" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023. <em>R for Data Science</em>. 2nd ed. O’Reilly Media. <a href="https://r4ds.hadley.nz/functions.html">https://r4ds.hadley.nz/functions.html</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./functions.html" class="pagination-link" aria-label="Writing User-Defined Functions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing User-Defined Functions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>