<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Advanced Topics in Writing Functions – Base R Essentials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./manipulations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./functions_2.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Topics in Writing Functions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Base R Essentials</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with Base R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Objects - Vectors, Matrices, and Arrays</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Objects - Lists and Data Frames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Subsetting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Subsetting Objects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing User-Defined Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Iteration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manipulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Manipulations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Topics in Writing Functions</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#file-handling" id="toc-file-handling" class="nav-link active" data-scroll-target="#file-handling"><span class="header-section-number">8.1</span> File Handling</a>
  <ul class="collapse">
  <li><a href="#commonly-used-functions-for-handling-files" id="toc-commonly-used-functions-for-handling-files" class="nav-link" data-scroll-target="#commonly-used-functions-for-handling-files"><span class="header-section-number">8.1.1</span> Commonly Used Functions for Handling Files</a></li>
  <li><a href="#custom-directory-management-functions" id="toc-custom-directory-management-functions" class="nav-link" data-scroll-target="#custom-directory-management-functions"><span class="header-section-number">8.1.2</span> Custom Directory Management Functions</a></li>
  </ul></li>
  <li><a href="#function-arguments" id="toc-function-arguments" class="nav-link" data-scroll-target="#function-arguments"><span class="header-section-number">8.2</span> Function Arguments</a>
  <ul class="collapse">
  <li><a href="#formal-vs.-actual-arguments-and-the-ellipsis" id="toc-formal-vs.-actual-arguments-and-the-ellipsis" class="nav-link" data-scroll-target="#formal-vs.-actual-arguments-and-the-ellipsis"><span class="header-section-number">8.2.1</span> Formal vs.&nbsp;Actual Arguments and the … Ellipsis</a></li>
  <li><a href="#argument-matching-rules-in-r" id="toc-argument-matching-rules-in-r" class="nav-link" data-scroll-target="#argument-matching-rules-in-r"><span class="header-section-number">8.2.2</span> Argument Matching Rules in R</a></li>
  <li><a href="#using-the-...-argument-for-flexible-inputs" id="toc-using-the-...-argument-for-flexible-inputs" class="nav-link" data-scroll-target="#using-the-...-argument-for-flexible-inputs"><span class="header-section-number">8.2.3</span> Using the <code>...</code> Argument for Flexible Inputs</a></li>
  </ul></li>
  <li><a href="#controlling-function-output-return-and-invisible" id="toc-controlling-function-output-return-and-invisible" class="nav-link" data-scroll-target="#controlling-function-output-return-and-invisible"><span class="header-section-number">8.3</span> Controlling Function Output: <code>return()</code> and <code>invisible()</code></a></li>
  <li><a href="#lexical-scoping-and-environments" id="toc-lexical-scoping-and-environments" class="nav-link" data-scroll-target="#lexical-scoping-and-environments"><span class="header-section-number">8.4</span> Lexical Scoping and Environments</a>
  <ul class="collapse">
  <li><a href="#environments-and-lookup" id="toc-environments-and-lookup" class="nav-link" data-scroll-target="#environments-and-lookup"><span class="header-section-number">8.4.1</span> Environments and Lookup</a></li>
  <li><a href="#lexical-scoping" id="toc-lexical-scoping" class="nav-link" data-scroll-target="#lexical-scoping"><span class="header-section-number">8.4.2</span> Lexical Scoping</a></li>
  </ul></li>
  <li><a href="#debugging-functions-with-browser" id="toc-debugging-functions-with-browser" class="nav-link" data-scroll-target="#debugging-functions-with-browser"><span class="header-section-number">8.5</span> Debugging Functions with <code>browser()</code></a></li>
  <li><a href="#case-study-chi-square-test-function-with-subgroups" id="toc-case-study-chi-square-test-function-with-subgroups" class="nav-link" data-scroll-target="#case-study-chi-square-test-function-with-subgroups"><span class="header-section-number">8.6</span> Case Study: Chi-Square Test Function with Subgroups</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Topics in Writing Functions</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Writing your own functions is a key step in becoming proficient with base R. This chapter covers advanced topics in function writing and “functional thinking” – treating functions as building blocks to solve problems. We will explore file handling functions, writing custom directory utilities, understanding function arguments (formal vs.&nbsp;actual, and the special .), R’s argument matching rules, using. for flexible inputs, controlling function output with <code>invisible()</code>, lexical scoping and environments, debugging with <code>browser()</code>.</p>
<section id="file-handling" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="file-handling"><span class="header-section-number">8.1</span> File Handling</h2>
<section id="commonly-used-functions-for-handling-files" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="commonly-used-functions-for-handling-files"><span class="header-section-number">8.1.1</span> Commonly Used Functions for Handling Files</h3>
<p>Functions in base R can handle files and directories. Many of these functions can be used within customized functions. Some of the most useful functions involving files include:</p>
<ul>
<li><code>getwd()</code> – Returns the current working directory path.</li>
<li><code>setwd("path")</code> - Sets the working directory to the specified path.</li>
<li><code>dir()</code> – Lists files in a directory. It has useful arguments like <code>path=</code> (directory to list), <code>pattern=</code> (a <em>regex</em> to filter filenames), <code>all.files=</code> (include hidden files), and <code>full.names=</code> (include full paths).</li>
<li><code>file.path()</code> – This function helps create platform-independent path strings by connecting the directory path with the file name.</li>
<li><code>file.info()</code> – Extracts information on files (size, date/time modified, among others), returning a data frame containing columns named ‘size’, ‘isdir’, ‘mode’, ‘timestamps’.</li>
<li><code>file.exists()</code> – Verifies if a given file or directory is existing (returns TRUE or FALSE).</li>
</ul>
<p>Now, let’s consider a few examples of this: hello</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show current working directory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/arthu/OneDrive/Documents/R_Book"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List files in the current directory </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "_quarto.yml"           "Add"                   "dat1.txt"             
 [4] "docs"                  "example1.txt"          "functions.html"       
 [7] "functions.qmd"         "functions_2.qmd"       "functions_2.rmarkdown"
[10] "ht.rds"                "index.html"            "index.qmd"            
[13] "intro.html"            "intro.qmd"             "iteration.html"       
[16] "iteration.qmd"         "LICENSE"               "manipulations.html"   
[19] "manipulations.qmd"     "objects1.html"         "objects1.qmd"         
[22] "objects2.html"         "objects2.qmd"          "patient.RData"        
[25] "Reader.Rproj"          "README.md"             "Recipe"               
[28] "references.bib"        "references.qmd"        "RStudio.png"          
[31] "RStudio2.png"          "site_libs"             "Subsetting.html"      
[34] "Subsetting.qmd"        "Updates.docx"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a file path for a data subfolder</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.path</span>(<span class="st">"C:/Users/Student/Documents"</span>, <span class="st">"data"</span>, <span class="st">"raw_data.txt"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/Student/Documents/data/raw_data.txt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check existence of a file and get its size</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.exists</span>(<span class="st">"dat1.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Get file information</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(<span class="st">"dat1.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         size isdir mode               mtime               ctime
dat1.txt   64 FALSE  666 2025-10-29 14:38:47 2025-07-11 13:00:55
                       atime exe
dat1.txt 2025-10-29 14:38:47  no</code></pre>
</div>
</div>
<p>Other useful functions involving files are <code>file.create()</code> (for creating a file), <code>file.remove()</code>, <code>file.rename()</code>, <code>file.append()</code> (for appending information from one file into another), <code>dir.create()</code> (for making a directory), and <code>unlink()</code> (for deleting directories or files recursively)[6]. Features of R scripts/functions involving files can thus be extended by using all of the aforementioned functions.</p>
</section>
<section id="custom-directory-management-functions" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="custom-directory-management-functions"><span class="header-section-number">8.1.2</span> Custom Directory Management Functions</h3>
<p>Suppose we need a function which can tell us if there are any sub directories in a given directory, then give us the list of files of those sub directories. The following function will do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>list_files <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_name) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check that the directory exists</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dir_name)) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The given directory does not exist."</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get all items in the directory</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  all_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(dir_name)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(all_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"There are no files in the given directory."</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  file_names <span class="ot">&lt;-</span> <span class="fu">list</span>()  <span class="co"># will hold results</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop over each item; if it's a subdirectory, list its files</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (item <span class="cf">in</span> all_files) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    full_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, item)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use file.info()$isdir to check if item is a directory</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.info</span>(full_path)<span class="sc">$</span>isdir) {</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      file_names[[ item ]] <span class="ot">&lt;-</span> <span class="fu">list.files</span>(full_path)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(file_names) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"There is no subdirectory in the given folder."</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(file_names)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this function, we first check if the directory exists (<code>file.exists()</code>). For each item in the directory, we create its complete path (<code>file.path()</code>) and use <code>file.info(.)$isdir</code> to identify if it’s a directory. If it’s a directory, we use <code>list.files()</code> function on it, which will give us files in this directory, which we store in vectors (subdirectory names as vector names). If there aren’t subdirectories, it will print a messsage and return NULL. If subdirectories do exist, it will return a vector of vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_files</span>(<span class="st">"Recipe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Beef
[1] "Beef Bourguignon.doc"                    
[2] "Classic Pot-au-Feu.docx"                 
[3] "Company Pot Roast.doc"                   
[4] "Country Meat Loaf with Tomato Relish.doc"
[5] "Dry Aged Prime Rib Roast.docx"           

$Drinks
[1] "COCKTAIL RECIPES.doc"                                      
[2] "Horchata.docx"                                             
[3] "Limoncello Recipe _ Giada De Laurentiis _ Food Network.pdf"
[4] "MARGARITA.doc"                                             
[5] "Martha Sangria.doc"                                        
[6] "Ortanique Mojito.doc"                                      
[7] "RASPBERRY LEMONADE.doc"                                    

$Lamb
[1] "Balsamic Glazed Lamb Chops\u2028.docx"               
[2] "BONELESS LAMB WITH MUSHROOM CRUST AND LEEK PUREE.doc"
[3] "Curried Braised Lamb Shank.doc"                      
[4] "LAMB CHOPS WITH GARLIC-PARSLEY TOPPING.doc"          
[5] "Mustard Crusted Rack of Lamb.doc"                    
[6] "Rack of Lamb Persillade.doc"                         

$Other
[1] "Build-Your-Own Shish Kabobs.doc" "Caramel Rum Sauce.pdf"          
[3] "CLASSIC  PESTO.doc"              "Pistachio Mixed Herb Pesto.doc" 
[5] "Sarath's Lentil Curry.doc"      </code></pre>
</div>
</div>
<p>This particular function shows how base R facilities, including file handling functions, can be mixed with logic (loops, conditional statements) in order to create more sophisticated tools.</p>
</section>
</section>
<section id="function-arguments" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="function-arguments"><span class="header-section-number">8.2</span> Function Arguments</h2>
<section id="formal-vs.-actual-arguments-and-the-ellipsis" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="formal-vs.-actual-arguments-and-the-ellipsis"><span class="header-section-number">8.2.1</span> Formal vs.&nbsp;Actual Arguments and the … Ellipsis</h3>
<p>While coding functions, it is important to understand the difference between formal arguments and actual arguments. The parameters defined in functions are known as formal arguments. Actual arguments refer to the values provided during the calling of functions. For instance:</p>
<pre><code># Define a function with two formal arguments x1 and x2
f &lt;- function(x1, x2) {
    # function body (not shown)
}
# Call the function with actual arguments var1 and var2
f(var1, var2)</code></pre>
<p>In this example, <code>x1</code> and <code>x2</code> represent the formal arguments of the function (placeholders within the function), while <code>var1</code> and <code>var2</code> are the actual arguments passed in the call. Knowing this difference can help explain how data is passed into functions.</p>
<p>In R, the special formal argument <code>...</code> (ellipsis) allows a function to accept any number of additional arguments. This is useful for passing arbitrary optional arguments to another function. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>simple_T_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2, ...) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(x1, x2, ...) </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result<span class="sc">$</span>p.value)        </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>var2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">60</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">simple_T_test</span>(var1, var2, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.60172e-05</code></pre>
</div>
</div>
<p>In <code>simple_T_test()</code>, the formal arguments are <code>x1</code>, <code>x2</code>, and. We call <code>t.test(x1, x2, ...)</code> inside the function, so any additional arguments we pass into <code>simple_T_test()</code> will be forwarded to <code>t.test()</code>. In the example, we pass <code>var.equal = TRUE</code> as an extra argument, which <code>t.test()</code> uses (it treats the two samples as having equal variance). The function then returns the p-value from the test result. Using <code>...</code> in this way makes our function flexible – it can handle alternative arguments like <code>alternative = "greater"</code> or <code>conf.level = 0.99</code> if needed, even though we didn’t explicitly list those in the function definition.</p>
</section>
<section id="argument-matching-rules-in-r" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="argument-matching-rules-in-r"><span class="header-section-number">8.2.2</span> Argument Matching Rules in R</h3>
<p>When you call a function, how do the actual arguments get matched to the formal parameters? R uses a specific set of rules to match arguments by name or position. The rules, in order, are:</p>
<ol type="1">
<li><strong>Exact name matching</strong>: If you call a function with some arguments in <code>name = value</code> form, any names that exactly match a formal argument name will be matched first.</li>
<li><strong>Unique partial name matching</strong>: Remaining unmatched named arguments are then matched by partial matching – if the name you provided partially matches one formal argument and is unique, it will be matched to that formal argument. Partial matching is not recommended as it can lead to ambiguity.</li>
<li><strong>Positional matching</strong>: Any arguments left unmatched by name are assigned to the remaining formal arguments in the order they are listed in the function definition.</li>
<li><strong>Matching to …</strong>: If the function has a <code>...</code> and there are still additional arguments not matched by the above steps, those arguments will be gathered into the special argument (<code>...</code>) for use inside the function.</li>
</ol>
<p>Consider the function <code>f()</code> defined with multiple parameters including <code>...</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, argument, arg3, ...) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"arg1:"</span>, arg1, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"arg2:"</span>, arg2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"argument:"</span>, argument, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"arg3:"</span>, arg3, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Result from t-test: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(...)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">arg2 =</span> <span class="st">"first"</span>, <span class="at">argu =</span> <span class="st">"third"</span>, <span class="st">"second"</span>, <span class="st">"fourth"</span>, var1, var2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>arg1: second 
arg2: first 
argument: third 
arg3: fourth 
Result from t-test: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  var1 and var2
t = -4.4396, df = 107.42, p-value = 2.194e-05
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -2.783333 -1.065022
sample estimates:
mean of x mean of y 
 2.794226  4.718403 </code></pre>
</div>
</div>
<p>In the call above, we provided six actual arguments to <code>f()</code>. Here’s how R matches them to the formal arguments:</p>
<ul>
<li><code>arg2 = "first"</code> matches exactly the formal <code>arg2</code> by name (Rule 1).</li>
<li><code>argu = "third"</code> doesn’t exactly match any formal argument, but it is a unique partial match for the formal argument (Rule 2, partial matching: <code>"argu"</code> matches <code>"argument"</code>). Thus, <code>argument</code> gets value <code>"third"</code>.</li>
<li>The next two values <code>"second"</code> and <code>"fourth"</code> are unnamed. This is positional matching (Rule 3); <code>arg1 = "second"</code> and <code>arg3 = "fourth"</code>.</li>
<li>We still have two extra values <code>var1</code> and <code>var2</code> with no formal parameters left. Since <code>f()</code> has a <code>...</code> in its definition, those leftover values fall into <code>...</code>. In our example, these values are passed to <code>t.test()</code>.</li>
</ul>
</section>
<section id="using-the-...-argument-for-flexible-inputs" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="using-the-...-argument-for-flexible-inputs"><span class="header-section-number">8.2.3</span> Using the <code>...</code> Argument for Flexible Inputs</h3>
<p>We’ve seen that <code>...</code> can capture additional arguments to pass along. You can also use <code>...</code> to explicitly accept a variable number of inputs and then iterate over them inside your function. This is a common pattern for writing functions that aggregate or analyze an arbitrary number of data objects. For example, some functions in base R utilize this technique, such as <code>paste()</code> and <code>cat()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="at">sep=</span><span class="st">" + "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a + b + c"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="at">sep=</span><span class="st">"+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a+b"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">"John"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Good morning!</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Good morning!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Good morning "</span>, name, <span class="st">"!</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Good morning John!</code></pre>
</div>
</div>
<p>Suppose we want a function that takes any number of numeric vectors and returns their means and variances in one go. We can write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize any number of numeric vectors</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>means_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(..., <span class="at">na.rm =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(...)            <span class="co"># capture inputs</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(data_list) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Provide at least one vector."</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute per-vector mean/variance using the named options</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_list, \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> na.rm))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  vars  <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_list, \(x) <span class="fu">var</span>(x, <span class="at">na.rm =</span> na.rm))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">mean =</span> means, <span class="at">var =</span> vars)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">3</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="fu">means_vars</span>(a, b, d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          mean       var
[1,] 0.1292699 0.9235968
[2,] 2.3333333 2.3333333
[3,] 0.1350951 0.7005634</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">means_vars</span>(a, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          mean       var
[1,] 0.1292699 0.9235968
[2,]        NA        NA</code></pre>
</div>
</div>
<p>There are two arguments in <code>mean_vars()</code>. The <code>...</code> argument allows users to pass arbitrary numbers of argument to the function. A named argument <code>na.rm=</code> is used to control how to handle the missing values in the <code>mean()</code> and <code>var()</code> functions. Anything after <code>...</code> must be named when the function is called.</p>
<p>Within the function, all the arguments that pass through <code>...</code> are are gathered into a list. We then use <code>sapply()</code> to apply <code>mean()</code> and <code>var()</code> to each element of that list, obtaining numeric vectors of means and variances. Lastly, we combine those into a two-column matrix and is returned by the function.</p>
<p>The. makes our function flexible – whether we have 1 vector or 100 vectors, <code>mean_vars()</code> will handle them.</p>
</section>
</section>
<section id="controlling-function-output-return-and-invisible" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="controlling-function-output-return-and-invisible"><span class="header-section-number">8.3</span> Controlling Function Output: <code>return()</code> and <code>invisible()</code></h2>
<p>The default behavior of an R function is to return the result of the last expression in its body. The <code>return()</code> function can be used to return a result explicitly from inside a function. The issue of how values will be printed can be considered a nuance of functions. For instance, if you execute a function in an R environment without assigning it an output, R will auto-print the return value. However, if an assignment of the result is done, then R won’t auto-print the return values. The <code>invisible()</code> function provides flexibility on how values will be printed.</p>
<p>Consider the following function that calculates the area of a circle and prints a message:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cal_area <span class="ot">&lt;-</span> <span class="cf">function</span>(r) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    area <span class="ot">&lt;-</span> pi <span class="sc">*</span> r <span class="sc">*</span> r</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Area is:"</span>, area, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(area)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calling the function without assignment</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cal_area</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area is: 78.53982 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78.53982</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calling the function and assigning the result</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cal_area</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area is: 78.53982 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78.53982</code></pre>
</div>
</div>
<p>In this example, if we directly call <code>cal_area(5)</code>, it will both print “Area is: 78.53982” (because of the cat call in the function statement) and then also print “78.53982” (because we didn’t store the return value in anything, so it automatically gets printed by R). Now, in the second case, we store the return value in <code>result</code>, so it will only print <code>"Area is: 78.53982"</code>, while the “78.53982” will be stored inside <code>result</code> (as we can verify by printing <code>result</code>). Hence, in both examples, it invoked <code>return(area)</code> from the function. The difference is that in one case it gets printed by R, while in the other it doesn’t.</p>
<p>If we do not want the return value automatically printed (perhaps because this function already writes something useful), we can use <code>invisible()</code> on the return value. Here’s a variant of the function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cal_area2 <span class="ot">&lt;-</span> <span class="cf">function</span>(r) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    area <span class="ot">&lt;-</span> pi <span class="sc">*</span> r <span class="sc">*</span> r</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Area is:"</span>, area, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(area)   <span class="co"># return invisibly</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cal_area2</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area is: 78.53982 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cal_area2</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area is: 78.53982 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78.53982</code></pre>
</div>
</div>
<p>In <code>cal_area2()</code>, we use <code>invisible(area)</code> in place of <code>return(area)</code>. When calling the function without assignment, we observe that the <code>cat()</code> function prints <code>"Area is: ..."</code>, though no numeric value follows it. The value is still returned, but it’s returned invisibly – meaning R will not print it unless explicitly asked.</p>
<p>Now, upon assignment of this output into <code>result</code>, we find that we’re basically back where we started; <code>cat()</code> statement gets printed, and its value gets assigned into <code>result</code>. The use of <code>invisible()</code> comes in handy in functions which will usually be called merely as a side effect (printing or plotting, for instance), though they still return an object which has potential use.</p>
</section>
<section id="lexical-scoping-and-environments" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="lexical-scoping-and-environments"><span class="header-section-number">8.4</span> Lexical Scoping and Environments</h2>
<section id="environments-and-lookup" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="environments-and-lookup"><span class="header-section-number">8.4.1</span> Environments and Lookup</h3>
<p>R is a lexically scoped language, which has an effect on how functions evaluate values of free variables (variables not defined in the function). The concept of lexical scoping refers to how R searches for the value of the symbol (variable) first in the environment in which it was defined, then in the parental environment. For this explanation, it is important that we understand how environments work<span class="citation" data-cites="chambers2008sda">(<a href="#ref-chambers2008sda" role="doc-biblioref">Chambers 2008</a>)</span>.</p>
<ul>
<li><p>An environment is a set of symbol-value pairs (a set of variables and their values). Each function in R has an environment in which it was created (its enclosing environment).</p></li>
<li><p>Environments are hierarchical, with each environment containing a pointer to its parent environment, except the empty environment at the root. The root environment is the global environment, or the environment of your R session. The global environment is the parent of the environment of user-defined functions defined at the top level. The chain of parent environments eventually ends at the base package environment.</p></li>
<li><p>Each time you call a function, R makes a fresh evaluation environment that contains the function’s arguments (bound to the values you passed) and any local variables created during the call. That environment’s parent is the function’s enclosing environment—the place where the function was defined.</p></li>
</ul>
<p>A simple demonstration of how scoping works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R looks for variables in its defined environment first, then up the chain.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.732051</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redefine sqrt in the global environment</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>sqrt <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">*</span> x    <span class="co"># our custom sqrt function (squares the input)</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<p>What’s happened in this snippet is that we temporarily masked the base R function <code>sqrt()</code> by assigning our own function the name <code>sqrt()</code> in the global environment. Later on, when we typed <code>sqrt(3)</code>, it invoked our <code>sqrt()</code> function (returning 9) rather than the base <code>sqrt()</code> function. This occurred since R searched first in the global environment (where we defined the <code>sqrt()</code> function), then in the base environment. The following illustrates the search path that R uses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ".GlobalEnv"        "package:stats"     "package:graphics" 
[4] "package:grDevices" "package:utils"     "package:datasets" 
[7] "package:methods"   "Autoloads"         "package:base"     </code></pre>
</div>
</div>
<p>We see that <code>".GlobalEnv"</code> (global environment) is searched first, followed by <code>"package:base"</code> as last. After finishing this example, it’s a good idea to remove or rename the custom <code>sqrt()</code> to avoid confusion with the base function.</p>
</section>
<section id="lexical-scoping" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="lexical-scoping"><span class="header-section-number">8.4.2</span> Lexical Scoping</h3>
<p>The significance of lexical scoping arises in the context of free variables in functions. The free variable is the symbol which is used in a function but is not considered as a parameter of the function nor defined in the function. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="dv">2</span>       <span class="co"># local variable a</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> y <span class="sc">+</span> a    <span class="co"># y is not defined inside g -&gt; free variable</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The variable <code>y</code> is a free variable in function <code>g()</code>. According to lexical scoping rules, <code>g()</code> will first look into the environment from which <code>g()</code> was created. Since we defined <code>g()</code> at the top level, this is the global environment. The global environment will provide the value of <code>y</code> if it’s defined there. Otherwise, R will continue looking into attached packages, giving an error if it doesn’t find it.</p>
<p>Let’s illustrate with a concrete scenario:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span>            <span class="co"># define y in the global environment</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="dv">2</span>        <span class="co"># local to g</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> y <span class="sc">+</span> a     <span class="co"># y is free, will be looked up in enclosing env (global)</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="dv">1</span>        <span class="co"># local y in f1</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">+</span> <span class="fu">g</span>(x)      <span class="co"># calls g, which will use global y</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p>In this code, the function <code>g(x)</code> uses <code>y</code> (global) and <code>a</code> (local to g). We then define <code>f1(x)</code> which has its own local variable <code>y</code> and calls <code>g(x)</code>.</p>
<p>When we call <code>f1(1)</code>, the computation inside <code>f1()</code> proceeds as follows:</p>
<ul>
<li><p><code>y</code> = 1 (<code>y &lt;- 1</code>). (the local variable)</p></li>
<li><p><code>y + g(x)</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + g(x)</code></p></li>
<li><p>Calling <code>g(x)</code> is called. Inside g():</p>
<ul>
<li><code>x</code> = 1 (passed from <code>f1()</code>)</li>
<li><code>a</code> = 2 (<code>a &lt;- 2</code>)</li>
<li>In <code>x + y + a</code>, <code>y</code> is a free variable. R looks it up in the enclosing environment (the global environment), where <code>y &lt;- 2</code>. Therefore <code>x + y + a</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + 2 + 2 = 5</code>, and <code>g()</code> returns 5.</li>
</ul></li>
<li><p>Lastly, in the final expression inside <code>f1()</code>, <code>y + g(x)</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + 5 = 6</code>. Note that the value of <code>y</code> used here is the local variable within <code>f1()</code>, which equals 1.</p></li>
</ul>
<p>The key point: the <code>y &lt;- 1</code> in <code>f1()</code> did not affect the <code>y</code> used inside <code>g()</code>. If R were using dynamic scoping (where a function would look for variables in the calling environment), <code>g()</code> would have found <code>y = 1</code> from <code>f1()</code>. But R uses lexical scoping, so <code>g()</code> uses the global <code>y = 2</code>.</p>
<p>Consider another scenario where <code>g()</code> is defined inside <code>f2()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> y <span class="sc">+</span> a</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span>        </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">+</span> <span class="fu">g</span>(x)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<p>When we run <code>f2(1)</code>, here’s how the computation inside <code>f2()</code> unfolds:</p>
<ul>
<li><p><code>g()</code> is defined.</p></li>
<li><p><code>y</code> = 1 (<code>y &lt;- 1</code>). (the local variable)</p></li>
<li><p><code>y + g(x)</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + g(x)</code></p></li>
<li><p>Calling <code>g(x)</code> is called. Inside g():</p>
<ul>
<li><code>x</code> = 1</li>
<li><code>a</code> = 2 (<code>a &lt;- 2</code>)</li>
<li>In <code>x + y + a</code>, <code>y</code> is a free variable. R looks it up in the enclosing environment (the <code>f2()</code> function), where <code>y &lt;- 1</code>. Therefore <code>x + y + a</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + 1 + 2 = 4</code>, and <code>g()</code> returns 4.</li>
</ul></li>
<li><p>In the final expression inside <code>f2()</code>, <code>y + g(x)</code> <span class="math inline">\(\rightarrow\)</span> <code>1 + 4 = 5</code>.</p></li>
</ul>
<p>These example highlights how functions “carry” their defining environment with them.</p>
</section>
</section>
<section id="debugging-functions-with-browser" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="debugging-functions-with-browser"><span class="header-section-number">8.5</span> Debugging Functions with <code>browser()</code></h2>
<p>While coding functions, it is unavoidable that you will need to debug them. For that, there are several methods in base R, and the simplest form is using the <code>browser()</code> function. If <code>browser()</code> is used inside a function, it will result in the code stopping there, allowing it to shift to a debugging mode.</p>
<p>Consider this function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">browser</span>()    <span class="co"># Pause here for debugging</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> y <span class="sc">*</span> <span class="dv">3</span>  <span class="co"># This will run after you continue from browser</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(z)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we run <code>my_function(5)</code>, R will enter the browser mode when it hits the <code>browser()</code> call:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_function</span>(<span class="dv">5</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Called from: my_function(5)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Browse[1]&gt; </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function is paused at the <code>Browse[1]&gt;</code> prompt. Now we can type commands to explore the function environment or alter the execution. For instance, we can type the name of a variable, and it will display its value. If we type <code>y</code> at the prompt, we will see <code>7</code> displayed, since <code>y</code> equals <code>x + 2</code> and <code>x</code> was 5.</p>
<p>Additionally, we can use commands such as <code>n</code> (next) to run the next line of the function or <code>c</code> (continue) to continue running the function until it finishes or another breakpoint is reached.</p>
<p>If we choose that we’ve completed the process, we can type <code>Q</code> to end the browser, exiting the function. The <code>browser()</code> function is an efficient way to identify problems by viewing the expression’s environment at a particular location in a function. However, once we are satisfied that we are using it correctly, we need to delete (or comment out) the expression <code>browser()</code>.</p>
</section>
<section id="case-study-chi-square-test-function-with-subgroups" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="case-study-chi-square-test-function-with-subgroups"><span class="header-section-number">8.6</span> Case Study: Chi-Square Test Function with Subgroups</h2>
<p>As a practical application of the concepts above, let’s build a function that performs a chi-squared contingency test on a dataset. The following data <code>ht</code> contains three variables, including sex, race and height.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ht <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ht.rds"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ht)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  race sex height
1    A   F     64
2    A   F     65
3    A   F     64
4    A   F     64
5    A   F     61
6    A   F     60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ht)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> race   sex        height     
 A:32   F:45   Min.   :57.00  
 B:13   M:39   1st Qu.:61.00  
 W:39          Median :62.00  
               Mean   :63.32  
               3rd Qu.:65.00  
               Max.   :73.00  </code></pre>
</div>
</div>
<p>To investigate whether someone’s <code>height</code> varies by their <code>sex</code>, we can use the two-sample t-test. Alternatively, you can use the chi-square test to evaluate the association between gender and height. In this case, we need to recode the height variable as a categorical or indicator variable, such as <code>height_cat</code>, where <code>height_cat</code> = 1 if <code>height</code> is greater than a threshold value (e.g., the mean height), and <code>height_cat</code> = 0 otherwise. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>height_cat <span class="ot">&lt;-</span> ht<span class="sc">$</span>height<span class="sc">&gt;</span><span class="dv">63</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(height_cat, ht<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          
height_cat  F  M
     FALSE 33 16
     TRUE  12 23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(height_cat, ht<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  height_cat and ht$sex
X-squared = 7.6923, df = 1, p-value = 0.005546</code></pre>
</div>
</div>
<p>Note that to perform a valid chi-square test, all expected counts in each cell of the two-by-two table must be greater than or equal to 5, which can be obtained from the result of the <code>chisq.test()</code> function. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(height_cat, ht<span class="sc">$</span>sex)<span class="sc">$</span>expected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          ht$sex
height_cat     F     M
     FALSE 26.25 22.75
     TRUE  18.75 16.25</code></pre>
</div>
</div>
<p>For this task, we would like to generate a table (a data frame) that contains the chi-square statistics between the <code>sex</code> and <code>height_cat</code> variables for all people and the people within each ethnic group. The table should consist of four columns, with each row containing testing statistics for either all subjects combined or a specific racial group.</p>
<ul>
<li><code>Group</code>: labeled as ‘All’ for all subjects combined, or each racial group, such as ‘A’, ‘B’, and/or ‘W’.</li>
<li><code>Test</code>: indicates whether the chi-square test is valid or not. If one of the expected counts is less than 5, the Test column should have the value <code>"not valid"</code>; otherwise, it should be <code>"valid"</code>.</li>
<li><code>Chisq</code>: contains the chi-square statistics.</li>
<li><code>P</code>: contains the corresponding P-values.</li>
</ul>
<p>We will create two functions:</p>
<ol type="1">
<li><code>chi_sq()</code> – which performs a chi-square test for either all subjects or a specific ethnic group. The result should be a data frame with a single row.</li>
<li><code>chi_sq_all()</code> – which uses <code>chi_sq()</code> to produce a summary table for all subgroups, including all subjects combined and the user-specified subgroups.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>chi_sq <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, chr_var, num_var, <span class="at">cut_off =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If cut_off is not provided, use the mean of the numeric variable</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(cut_off)) {</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        cut_off <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat[, num_var])</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure cut_off is within the range of the numeric variable</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cut_off <span class="sc">&lt;=</span> <span class="fu">min</span>(dat[, num_var]) <span class="sc">||</span> cut_off <span class="sc">&gt;=</span> <span class="fu">max</span>(dat[, num_var])) {</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The cut_off value must be within the range of numVar."</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an indicator for whether num_var exceeds the cutoff</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    num_ind <span class="ot">&lt;-</span> dat[, num_var] <span class="sc">&gt;</span> cut_off</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform chi-square test on the categorical variable vs the indicator</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    chi_res <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(dat[, chr_var], num_ind, ...)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine if test is valid (all expected counts &gt;= 5)</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    valid_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(chi_res<span class="sc">$</span>expected <span class="sc">&lt;</span> <span class="dv">5</span>), <span class="st">"not valid"</span>, <span class="st">"valid"</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return a one-row data frame with results</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">test =</span> valid_flag,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">Chisq =</span> <span class="fu">as.numeric</span>(chi_res<span class="sc">$</span>statistic),</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">P =</span> chi_res<span class="sc">$</span>p.value)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_sq</span>(ht, <span class="st">"sex"</span>, <span class="st">"height"</span>, <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   test    Chisq          P
1 valid 6.042885 0.01396245</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_sq</span>(ht[ht<span class="sc">$</span>race <span class="sc">==</span> <span class="st">"A"</span>, ], <span class="st">"sex"</span>, <span class="st">"height"</span>, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   test      Chisq        P
1 valid 0.07529412 0.783779</code></pre>
</div>
</div>
<p>In this function:</p>
<ul>
<li><code>dat</code>: a data frame containing the data for one group or the whole dataset.</li>
<li><code>chr_var</code>: the name of the categorical variable (e.g., <code>"sex"</code>).</li>
<li><code>num_var</code>: the name of the numeric variable (e.g., <code>"height"</code>).</li>
<li><code>cut_off</code>: a numeric threshold for num_var to categorize it; if <code>NULL</code>, we use the mean of <code>numVar</code> as the threshold value.</li>
<li><code>...</code>: additional arguments to pass to <code>chisq.test()</code> (for example, <code>correct = FALSE</code> to disable Yates’ continuity correction).</li>
</ul>
<p>Inside <code>chi_sq()</code>:</p>
<ul>
<li>We compute <code>cut_off</code> if not provided, and we validate that this <code>cut_off</code> lies between the minimum and maximum of the numeric variable—otherwise, the test is not meaningful, and we stop with an error message.</li>
<li>We then create a logical vector <code>num_ind</code>, which is TRUE for observations where <code>num_var &gt; cut_off</code> (and FALSE otherwise).</li>
<li>The chi-square test (<code>chisq.test()</code>) is performed on the two categorical variables: <code>dat[, chr_var]</code> (e.g., <code>sex</code>) and <code>num_ind</code> (<code>height</code> above threshold).</li>
<li>We capture any extra arguments via <code>...</code> and pass them along to <code>chisq.test()</code> (this could include <code>correct=FALSE</code> or <code>simulate.p.value=TRUE</code>, etc., if specified).</li>
<li>We then examine <code>chi_res$expected</code>, which is the table of expected counts; if any expected count is less than 5, we mark the test as <code>"not valid"</code> (a common rule-of-thumb for chi-square tests).</li>
<li>Finally, we return a data frame with the validity flag, the chi-square statistic, and the p-value.</li>
</ul>
<p>Now for the wrapper function <code>chi_sq_all()</code> that iterates over groups:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>chi_sq_all <span class="ot">&lt;-</span> <span class="cf">function</span>(..., dat, group_var, chr_var, num_var, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cutOff =</span> <span class="cn">NULL</span>, <span class="at">correct =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Capture the ... group values (if any) into a vector</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    groups <span class="ot">&lt;-</span> <span class="fu">c</span>(...)  </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(groups) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If no groups specified, use all unique values of group_var</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>        groups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(dat[, group_var]))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify that all specified groups actually exist in data</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(groups <span class="sc">%in%</span> <span class="fu">as.character</span>(dat[, group_var]))) {</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"One or more specified groups are not present in the data."</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start with "All" (overall data) result</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    overall_res <span class="ot">&lt;-</span> <span class="fu">chi_sq</span>(dat, chr_var, num_var, cutOff, <span class="at">correct =</span> correct)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    results_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Group =</span> <span class="st">"All"</span>, overall_res)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each specified subgroup and get chi-square results</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (grp <span class="cf">in</span> groups) {</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>        sub_data <span class="ot">&lt;-</span> dat[dat[, group_var] <span class="sc">==</span> grp, ]</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>        grp_res <span class="ot">&lt;-</span> <span class="fu">chi_sq</span>(sub_data, chr_var, num_var, cutOff, </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">correct =</span> correct)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a column for group identifier</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        grp_res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Group =</span> grp, grp_res)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append to results_table</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        results_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_table, grp_res)</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(results_table)      <span class="co"># print the table for the user</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(results_table)  <span class="co"># return it invisibly</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_sq_all</span> (<span class="st">"A"</span>, <span class="at">dat =</span> ht, <span class="at">group_var =</span><span class="st">"race"</span>, <span class="at">chr_var =</span> <span class="st">"sex"</span>, </span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_var =</span> <span class="st">"height"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group  test      Chisq           P
1   All valid 8.97230769 0.002741022
2     A valid 0.07529412 0.783778983</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_sq_all</span> (<span class="st">"A"</span>, <span class="st">"W"</span>, <span class="at">dat =</span> ht, <span class="at">group_var =</span><span class="st">"race"</span>, <span class="at">chr_var =</span> <span class="st">"sex"</span>, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">num_var =</span> <span class="st">"height"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group  test      Chisq           P
1   All valid 8.97230769 0.002741022
2     A valid 0.07529412 0.783778983
3     W valid 9.39323308 0.002177878</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi_sq_all</span> (<span class="at">dat =</span> ht, <span class="at">group_var =</span><span class="st">"race"</span>, <span class="at">chr_var =</span> <span class="st">"sex"</span>, </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">num_var =</span> <span class="st">"height"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in chisq.test(dat[, chr_var], num_ind, ...): Chi-squared approximation
may be incorrect</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group      test      Chisq           P
1   All     valid 8.97230769 0.002741022
2     A     valid 0.07529412 0.783778983
3     B not valid 6.74074074 0.009423549
4     W     valid 9.39323308 0.002177878</code></pre>
</div>
</div>
<p>Key aspects of chi_sq_all():</p>
<ul>
<li>The <code>...</code> in the function definition is used in a unique way here: it’s intended to capture one or more group values (e.g., <code>"A"</code>, <code>"B"</code>). We immediately convert <code>...</code> to a vector groups. If <code>...</code> is empty, we default to all unique groups in the data (so the analysis will cover every group) .</li>
<li>We ensure the specified groups actually exist in the data; if not, we throw an error with <code>stop()</code>.</li>
<li>We first compute the overall (<code>"All"</code>) result by calling <code>chi_sq()</code> on the full dataset. This provides the chi-square test ignoring subgroups. We store that in a data frame with a new column <code>Group = "All"</code>.</li>
<li>Then we loop over each group in groups. For each <code>grp</code>, we subset the data (<code>dat[dat[, groupVar] == grp, ]</code> gives the data for that group), and call <code>chi_sq()</code> on that subset. We get a one-row result, add a <code>Group</code> column for the group name, and use <code>rbind()</code> to append it to our results table.</li>
<li>We use the <code>correct=</code> argument (which defaults to FALSE here for illustration) and pass it down to <code>chi_sq()</code> (which passes it to <code>chisq.test()</code>) to control Yates’ correction. This demonstrates how you can include specific arguments in your wrapper and still use <code>...</code> for group selection independently.</li>
<li>Finally, we p<code>rint(results_table)</code> so that the user sees the table, and return it invisibly (so that if the user assigns the result to a variable, they won’t get it printed twice).</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-chambers2008sda" class="csl-entry" role="listitem">
Chambers, John M. 2008. <em>Software for Data Analysis: Programming with r</em>. Statistics and Computing. New York: Springer. <a href="https://doi.org/10.1007/978-0-387-75936-4">https://doi.org/10.1007/978-0-387-75936-4</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./manipulations.html" class="pagination-link" aria-label="Data Manipulations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Manipulations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>